---
title: "Click Detection Outside a React Component: Simplified Integration Using Multiple Refs"
date: 2024-02-08 15:16:28 -0400
categories: "frontend"
tags:
    - React
    - Typescript
---

# Background
> This article extends upon the one I wrote on [React DnD](https://hkim-dev.github.io/frontend/Implement-Drag-and-Drop-for-React-App-with-React-DnD/). Check this one out too if interested! (or for better understanding :smiley:)


![layout](/assets/images/app_layout.jpeg)
*Figure 1. Simplified Layout of React App*

While enabling the click-to-fill behavior on top of Drag and Drop as per PO's request, I realized that it is almost counterintuitive not to remove UI effects appearing on a selected item **when the user has clicked outside of a desired/clickable area.** Just like how [input](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input) is, I thought the user would expect the component to have focus when clicked, and lose it when the user has clicked something else.
Hoping this curation of my train of thought & discoveries I made while working on the feature can be a thorough guide of the subject matter, let's start with the concept of ==React Ref==.


# What is a React Ref?
In a nutshell, it is a mutable reference that persists across component renders. As opposed to a state, it does not trigger new renders.

```tsx
const ref = useRef(0);
```

useRef returns an object like this so that you can access the current value of the ref through the `ref.current` property. 

```tsx
{ 
  current: 0 // The value you passed to useRef
}
```

Why do we need refs in the context of focus and blur? There is no built-in way to do manipulate those things in React, so we need a ref to access the DOM elements managed by React. Pass your ref as the ref attribute to the JSX tag for which you want to get the DOM node.

```tsx
<div ref={ref}>
```

Using the property `current`, you can access this DOM node.


# How to Detect Clicks Outside Clickable Area

![blue_layout](assets/images/blue_highlighted_app_layout.jpg)
*Figure 2. Clickable Area*

Let's begin with defining what a ==clickable area== is here. It really varies depending on individual use cases, but in my case, it is the blue colored area except for Picks and Items. The goal here is to reset a click on one of the items in the main grid when the consecutive click is made within the blue color background.

Another important question - what does a click does to the UI?

```tsx
const handleItemClick = () => {
  setClickedItem(item);
  setIsClicked(true);
};
```

A click on an item makes the selected item highlighted (or other visual effects you have in place for when isClicked is `true`) and sets a new value to a state variable `clickedItem`.


## `handleClickOutside` function

Now let's create a ref and put it to use. Refer to the following code for the implementation of the click event listener `handleClickOutside`. 


```tsx
const clickOutsideRef = useRef<HTMLDivElement>(null);

const handleClickOutside = (event: MouseEvent) => {
  if (clickOutsideRef.current && !clickOutsideRef.current.contains(event.target as HTMLElement)) {
    const isClickOnPick = !!event.target && (event.target as HTMLElement).closest('.pick'); // Check if the click occurred within a Pick component
    if (!isClickOnPick) { // click occurred outside of Pick, completely reset the behaviors related to tile clicks
      setClickedChampion(null);
    };
    setIsClicked(false);
  };
};

useEffect(() => {
  document.addEventListener('click', handleClickOutside, true); // bind the event listener
  return () => {
    document.removeEventListener('click', handleClickOutside, true); // unbind the listener on clean up
  };
}, []);
```
`handleClickOutside` checks if clickOutsideRef.current exists (i.e., if the referenced element exists in the DOM) and if the click event's target is not within the referenced element. If the click indeed occurs outside the referenced element, it further checks if the click occurred within an element with the class '.pick', which is another acceptable clickable area in my case. 


Make sure to pass `clickOutsideRef` to the component you wish to detect clicks outside. In my case, it's the Item component whose elements are defined as follows:
```tsx
<div
  ref={mergedRef}
  id={`item-tile-${index}`}
  key={index}
  className={`transform hover:scale-110 transition-transform duration-300 // increase the size on hover
    ${isDragging ? 'opacity-50 shadow-lg cursor-grabbing ease-in-out' : 'opacity-100 cursor-pointer ease-in-out'}
    ${isDropped ? 'grayscale pointer-events-none' : 'pointer-events-auto'}
    ${isClicked ? 'border-dotted border-2 border-indigo-600' : ''}
    rounded-lg`}
  onMouseDown={onDragStart}
  onClick={handleTileClick}
>
  <img
    className="mx-auto rounded-lg cursor-pointer filter"
    src={`${CONFIG.IMAGE_URL}/${item.image}`}
    alt={`${item.image}`}
  />
</div>
```



### References
- https://react.dev/learn/referencing-values-with-refs